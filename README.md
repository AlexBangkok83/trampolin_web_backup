# Trampolin Web ‚Äì Next.js SaaS Scaffold

A production-ready [Next.js 14](https://nextjs.org) SaaS scaffold with **TypeScript**, **Tailwind CSS**, strict ESLint/Prettier, Husky Git hooks and built-in Docker support.

---

## üõ† Prerequisites

| Tool    | Version (tested)        | Notes                                                                                                |
| ------- | ----------------------- | ---------------------------------------------------------------------------------------------------- |
| Node.js | ‚â• 20.x (LTS)            | Use [nvm](https://github.com/nvm-sh/nvm) or [fnm](https://github.com/Schniz/fnm) to manage versions. |
| npm     | comes with Node (‚â• 9.x) | pnpm/yarn/bun also work; commands below use npm.                                                     |
| Git     | any recent              | required for Husky hooks.                                                                            |
| Docker  | **optional**            | Needed when you reach the Docker setup task.                                                         |

---

## üöÄ Quick start

1. **Clone the repo**

   ```bash
   git clone https://github.com/<your-org>/trampolin-web.git
   cd trampolin-web
   ```

2. **Install dependencies**

   ```bash
   npm install
   ```

3. **Set up Git hooks** (runs Prettier/ESLint automatically on commits)

   ```bash
   npx husky install            # creates .husky/ directory
   npx husky add .husky/pre-commit "npx lint-staged"
   git add .husky/pre-commit
   git commit -m "chore: enable pre-commit hook"
   ```

   Husky is already listed in `devDependencies`, so no extra install is needed.

4. **Start the development server**
   ```bash
   npm run dev
   # open http://localhost:3000
   ```

---

## üìÇ Project structure (after setup)

```
‚îú‚îÄ app/              # Next.js App Router pages & layouts
‚îú‚îÄ components/       # Reusable UI components (to be added)
‚îú‚îÄ public/           # Static assets
‚îú‚îÄ src/              # Utility libs soon
‚îú‚îÄ .husky/           # Git hooks (created after husky install)
‚îú‚îÄ .eslint.config.mjs
‚îú‚îÄ postcss.config.mjs
‚îú‚îÄ tailwind.config.ts  (auto-generated by next/tailwind)
‚îî‚îÄ tsconfig.json
```

---

## üß∞ Useful scripts

| Command          | Purpose                                  |
| ---------------- | ---------------------------------------- |
| `npm run dev`    | Start Next.js dev server with hot-reload |
| `npm run build`  | Create production build                  |
| `npm start`      | Run production build                     |
| `npm run lint`   | Lint `src/` with ESLint                  |
| `npm run format` | Format all files with Prettier           |

---

## üìù Environment variables

Copy `.env.example` to `.env.local` and fill in values as you add features (database URLs, API keys, etc.). Next.js automatically loads `*.local` files.

### Required Environment Variables

For authentication and Stripe integration:

```bash
# NextAuth.js Configuration
NEXTAUTH_SECRET="your-nextauth-secret-here"  # Generate with: openssl rand -base64 32
NEXTAUTH_URL="http://localhost:3000"

# Stripe Payment Integration
STRIPE_SECRET_KEY="sk_test_..."              # Your Stripe secret key
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY="pk_test_..." # Your Stripe publishable key
STRIPE_WEBHOOK_SECRET="whsec_..."            # Webhook endpoint secret from Stripe dashboard

# Database
DATABASE_URL="postgres://postgres:postgres@localhost:5432/trampolin"
```

See `STRIPE_SETUP.md` for detailed Stripe configuration instructions.

---

## üß™ Testing Stripe Integration

### Prerequisites for Testing

1. **Install Stripe CLI**

   ```bash
   # macOS
   brew install stripe/stripe-cli/stripe

   # Or download from https://stripe.com/docs/stripe-cli
   ```

2. **Login to Stripe**
   ```bash
   stripe login
   ```

### Local Webhook Testing

1. **Forward webhooks to your local development server**

   ```bash
   stripe listen --forward-to localhost:3000/api/webhooks/stripe
   ```

   This command will output a webhook signing secret (starts with `whsec_`). Add this to your `.env.local`:

   ```bash
   STRIPE_WEBHOOK_SECRET="whsec_1234567890abcdef..."
   ```

2. **Trigger test events** (in a separate terminal)

   ```bash
   # Test subscription creation
   stripe trigger customer.subscription.created

   # Test subscription update
   stripe trigger customer.subscription.updated

   # Test payment success
   stripe trigger invoice.payment_succeeded

   # Test payment failure
   stripe trigger invoice.payment_failed
   ```

### Test Credit Cards

Use these test card numbers in your application:

| Card Number        | Description                         |
| ------------------ | ----------------------------------- |
| `4242424242424242` | Successful payment                  |
| `4000000000000002` | Card declined                       |
| `4000002500003155` | Requires authentication (3D Secure) |
| `4000000000000069` | Expired card                        |

### Testing Workflow

1. **Start your development server**

   ```bash
   npm run dev
   ```

2. **Start webhook forwarding**

   ```bash
   stripe listen --forward-to localhost:3000/api/webhooks/stripe
   ```

3. **Test the subscription flow**
   - Navigate to `/dashboard/subscription`
   - Select a plan and subscribe
   - Use test card `4242424242424242`
   - Check webhook logs for events

4. **Monitor webhook events**

   ```bash
   # View webhook logs
   stripe logs tail

   # View specific event
   stripe events retrieve evt_1234567890
   ```

### Debugging Tips

- Check your application logs for webhook processing
- Verify webhook signature verification is working
- Use Stripe Dashboard ‚Üí Developers ‚Üí Events to see all webhook deliveries
- Test both successful and failed payment scenarios

---

## üê≥ Docker

### Installing Docker Desktop on macOS

1. **Download installer**  
   Visit <https://www.docker.com/products/docker-desktop/> and download the "Docker Desktop for Mac (Apple Silicon / Intel)" build matching your chip.
2. **Install**  
   Double-click the `.dmg` and drag the _Docker_ icon into **Applications**.
3. **Launch & grant privileges**  
   Open _Docker Desktop_ from **Applications**. At first start macOS will ask for privileged access to install networking components; choose **OK** and enter your password.
4. **Enable "Use Rosetta" (Intel-only images on Apple Silicon)**  
   On Apple Silicon Macs open _Settings ‚Üí Features in development ‚Üí Use Rosetta for x86/amd64 emulation_ if you need to run Intel images.
5. **Adjust resources (optional)**  
   _Settings ‚Üí Resources_ allows you to tweak CPUs / Memory / Disk. 2 CPU / 4 GB RAM is plenty for this project.
6. **Enable Docker Compose V2** (default)  
   Compose V2 ships as `docker compose` (space, no hyphen). Ensure **Settings ‚Üí General ‚Üí Use Docker Compose V2** is checked.
7. **Verify installation**
   ```bash
   docker --version      # e.g. Docker version 24.x
   docker compose version
   ```
   Both commands should output versions without error.

> ‚ö†Ô∏è **Tip**: If you previously used tools like _Colima_ or _Docker-Machine_, stop them to avoid port conflicts.

With Docker Desktop running you can spin up the local stack from the project root:

```bash
docker compose up --build   # Next.js + PostgreSQL
```

---

This repository ships with a multi-stage `Dockerfile` and a `docker-compose.yml` for a full local stack.

```bash
# development stack (Next.js dev server + Postgres)
docker compose up --build

# build & run production image
docker build -t trampolin-web .
docker run -p 3000:3000 -e NODE_ENV=production trampolin-web
```

for a one-command local stack.

---

## üí° Further reading

- [Next.js Docs](https://nextjs.org/docs)
- [Tailwind CSS Docs](https://tailwindcss.com/docs)
- [ESLint](https://eslint.org/) / [Prettier](https://prettier.io/)

Enjoy building! üöÄ

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Git hooks (Husky & lint-staged)

Git hooks run **Prettier** (via `lint-staged`) before every commit, keeping code formatted automatically.

```bash
# One-time setup (after npm install):
npx husky install                       # creates .husky/
npx husky add .husky/pre-commit "npx lint-staged"
```

`husky` and `lint-staged` are already in `devDependencies`, so no extra install is needed.

The pre-commit hook will run Prettier (and any other lint-staged tasks) on staged files before every commit, ensuring code is consistently formatted.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
